UPDATE sec_ace SET conditionalScript='importClass(Packages.es.logongas.fpempresa.modelo.titulado.TipoFormacionAcademica)\r\nvar candidato=arguments.entity;\r\nvar ciclosOferta=candidato.getOferta().getCiclos();\r\nvar usuario=candidato.usuario;\r\nvar formacionesAcademicas=identity.titulado.formacionesAcademicas;\r\nvar centro=candidato.oferta.empresa.centro;\r\n\r\nif (usuario.idIdentity!==identity.idIdentity) {\r\n  return false;\r\n}\r\n\r\n\r\nfunction isRealizadoCiclo(formacionesAcademicas,idCiclo,centro) {\r\n    for (var iterator = formacionesAcademicas.iterator(); iterator.hasNext();) {\r\n       var formacionAcademica=iterator.next();\r\n        if (formacionAcademica.tipoFormacionAcademica===TipoFormacionAcademica.CICLO_FORMATIVO) {\r\n            if (formacionAcademica.ciclo.idCiclo===idCiclo) {\r\n\r\n              if (( typeof(centro)=="object") &&  (centro!=null))  {\r\n                    //Comprobar tambien que ha hecho el ciclo en el centro\r\n                    if ( ( typeof(formacionAcademica.centro)=="object") &&  (formacionAcademica.centro!=null)) {\r\n                         if (formacionAcademica.centro.idCentro===centro.idCentro) {\r\n                            return true;\r\n                         } else {\r\n		//No hacer nada\r\n		    //El ciclo no lo ha hecho en este centro\r\n                         }\r\n                    } else {\r\n	     //No hacer nada\r\n	//No hay centro en el ciclo , as√≠ que seguro que no lo ha hecho aqui\r\n                    }\r\n               } else {\r\n			      //Si no hay centro, seguro que lo ha realizado\r\n                  return true;\r\n               }\r\n				\r\n            }\r\n        }\r\n   }\r\n   return false;\r\n}\r\nfor (var iterator = ciclosOferta.iterator(); iterator.hasNext();) {\r\n   var ciclo=iterator.next();\r\n   if ( isRealizadoCiclo(formacionesAcademicas,ciclo.idCiclo,centro)===true) {\r\n      return true;\r\n   }\r\n\r\n}\r\n\r\n\r\nreturn false;' 
WHERE aceType='Allow' AND idPermission=22 AND idIdentity=32 AND secureResourceRegExp='.*BusinessProcess.Candidato.insert';